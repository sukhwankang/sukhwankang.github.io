---
layout: post
title: UVM Practice (1) Adder Verification
date: 2025-01-08
description: UVM Practice
tags: UVM SystemVerilog Verification
categories: sample-posts
featured: true
---

UVM Verification
I fetched the example code, made some modifications, and executed the simulation on [EDA Playground](https://edaplayground.com).

### Block diagram


<div class="row mt-3">
      <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_blockdiagram.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
      </div>
</div>
<div class="caption">
    Blockdiagram
</div>



### Class env

```verilog
//----------------
// environment env
//----------------
class env extends uvm_env;

  virtual add_sub_if m_if;

  function new(string name, uvm_component parent = null);
    super.new(name, parent);
  endfunction
  
  function void connect_phase(uvm_phase phase);
    `uvm_info("LABEL", "Started connect phase.", UVM_HIGH);
    // Get the interface from the resource database.
    assert(uvm_resource_db#(virtual add_sub_if)::read_by_name(get_full_name(), "add_sub_if", m_if));
    `uvm_info("LABEL", "Finished connect phase.", UVM_HIGH);

  endfunction: connect_phase

  task run_phase(uvm_phase phase);
    phase.raise_objection(this);
    `uvm_info("LABEL", "Started run phase.", UVM_HIGH);
    begin
      int a = 8'h2, b = 8'h3;
      parameter int LOOP_COUNT = 10;
      `uvm_info("LABEL", "Check Addition", UVM_HIGH);
      for(int i=0;i<LOOP_COUNT;i++) begin
        @(m_if.cb);
        m_if.cb.a <= a;
        m_if.cb.b <= b;
        m_if.cb.doAdd <= 1'b1; //Addition
        repeat(2) @(m_if.cb);
        `uvm_info("RESULT", $sformatf("%0d + %0d = %0d", 
         a, b, m_if.cb.result), UVM_LOW);
        //assert checking the result
        assert(m_if.cb.result == (a + b))
          else `uvm_error("RESULT_ERR", $sformatf("Result Error! result=%0d, not %0d", m_if.cb.result, a+b));
        a = a + 1;
        b = b + 1;
        `uvm_info("CHANGE VALUE", $sformatf("a=%0d, b=%0d", a, b), UVM_LOW);
      end
      `uvm_info("LABEL", "Finish Check Addition", UVM_HIGH);      
      #400;
      b = 11;
      `uvm_info("LABEL", "Check Substraction", UVM_HIGH);
      for(int i=0;i<LOOP_COUNT;i++) begin
        @(m_if.cb);
        m_if.cb.a <= a;
        m_if.cb.b <= b;
        m_if.cb.doAdd <= 1'b0; //Substraction
        repeat(2) @(m_if.cb);
        `uvm_info("RESULT", $sformatf("%0d - %0d = %0d", 
         a, b, m_if.cb.result), UVM_LOW);
        //assert checking the result
        assert(m_if.cb.result == (a - b))
          else `uvm_error("RESULT_ERR", $sformatf("Result Error! result=%0d, not %0d", m_if.cb.result, a-b));
        b = b - 1;
        `uvm_info("CHANGE VALUE", $sformatf("a=%0d, b=%0d", a, b), UVM_LOW);
      end
      `uvm_info("LABEL", "Finish Check Substraction", UVM_HIGH);
    end
    `uvm_info("LABEL", "Finished run phase.", UVM_HIGH);
    phase.drop_objection(this);
  endtask: run_phase
  
endclass
```

### DUT and Interface

```verilog
// Simple adder/subtractor module
module ADD_SUB(
  input            clk,
  input [7:0]      a0,
  input [7:0]      b0,
  // if this is 1, add; else subtract
  input            doAdd0,
  output reg [8:0] result0
);

  always @ (posedge clk)
    begin
      if (doAdd0)
        result0 <= a0 + b0;
      else
        result0 <= a0 - b0;
    end

endmodule: ADD_SUB

//---------------------------------------
// Interface for the adder/subtractor DUT
//---------------------------------------
interface add_sub_if(
  input bit clk,
  input [7:0] a,
  input [7:0] b,
  input       doAdd,
  input [8:0] result
);

  clocking cb @(posedge clk);
    output    a;
    output    b;
    output    doAdd;
    input     result;
  endclocking // cb

endinterface: add_sub_if

//---------------
// Interface bind
//---------------
bind ADD_SUB add_sub_if add_sub_if0(
  .clk(clk),
  .a(a0),
  .b(b0),
  .doAdd(doAdd0),
  .result(result0)
);
```

### Testbench

```verilog
import uvm_pkg::*;
`include "uvm_macros.svh"
`include "env.sv"

//-----------
// module top
//-----------
module top;

  bit clk;
  env environment;
  ADD_SUB dut(.clk (clk));

  initial begin
    environment = new("env");
    // Put the interface into the resource database.
    uvm_resource_db#(virtual add_sub_if)::set("env",
      "add_sub_if", dut.add_sub_if0);
    clk = 0;
    run_test();
  end
  
  initial begin
    forever begin
      #(50) clk = ~clk;
    end
  end
  
  initial begin
    // Dump waves
    $dumpvars(0, top);
  end
  
endmodule
```

### Option
+UVM_VERBOSITY=UVM_HIGH +access+r

### Result Waveform

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_1.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
</div>
<div class="caption">
    Result waveform
</div>

### UVM Logs

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_2.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
      <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_3.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
      <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_4.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
      <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/blogimg/uvmpractice1_5.PNG" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
</div>
<div class="caption">
    UVM Logs
</div>


You must indent your code by **(3 \* bullet_indent_level)** spaces. This is because kramdown (the markdown engine used by Jekyll) indentation for the code block in lists is determined by the column number of the first non-space character after the list item marker. For example:

